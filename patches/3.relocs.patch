From 720e61b22e958b751058935df8eac7d26a6cec42 Mon Sep 17 00:00:00 2001
From: Kevindeving <98kevchen@gmail.com>
Date: Sat, 10 Oct 2015 18:31:59 -0400
Subject: [PATCH] Revert "Remove text-relocs support for apps targeting M+"

This reverts commit 3e6f7807541bab8157f9c26e55829fd193683349.
---
 linker/linker.cpp | 7 -------
 1 file changed, 7 deletions(-)

diff --git a/linker/linker.cpp b/linker/linker.cpp
index b860f70..1756ca9 100644
--- a/linker/linker.cpp
+++ b/linker/linker.cpp
@@ -2932,13 +2932,6 @@ bool soinfo::link_image(const soinfo_list_t& global_group, const soinfo_list_t&
 
 #if !defined(__LP64__)
   if (has_text_relocations) {
-    // Fail if app is targeting sdk version > 22
-    // TODO (dimitry): remove != __ANDROID_API__ check once http://b/20020312 is fixed
-    if (get_application_target_sdk_version() != __ANDROID_API__
-        && get_application_target_sdk_version() > 22) {
-      DL_ERR("%s: has text relocations", get_realpath());
-      return false;
-    }
     // Make segments writable to allow text relocations to work properly. We will later call
     // phdr_table_protect_segments() after all of them are applied and all constructors are run.
     DL_WARN("%s has text relocations. This is wasting memory and prevents "
